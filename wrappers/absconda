#!/bin/bash
# Auto-generated by absconda wrap
# Image: ghcr.io/swarbricklab/absconda:0.1.0
# Command: absconda
set -euo pipefail

SIF_CACHE="/Users/johree/.local/absconda/sif-cache"
SIF_FILE="${SIF_CACHE}/swarbricklab_absconda_0.1.0.sif"
IMAGE_REF="docker://ghcr.io/swarbricklab/absconda:0.1.0"

# Pull SIF if missing
if [[ ! -f "$SIF_FILE" ]]; then
    mkdir -p "$SIF_CACHE"
    echo "Pulling Singularity image to cache..." >&2
    singularity pull "$SIF_FILE" "$IMAGE_REF"
fi

# Build mount arguments
MOUNTS=()
MOUNTS+=("-B" "$HOME")
MOUNTS+=("-B" "$PWD")
MOUNTS+=("-B" "/g/data/a56")
MOUNTS+=("-B" "/scratch/a56")

GPU_FLAG=""

# Execute command in container
exec singularity exec \
    $GPU_FLAG \
    "${MOUNTS[@]}" \
    "$SIF_FILE" \
    absconda "$@"
